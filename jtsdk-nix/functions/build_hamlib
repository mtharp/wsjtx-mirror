#
# Part of the JTSDK-NIX Project
# Custom Hamlib Build from Bill (G3WJS) Fork

#------------------------------hamlib build------------------------------------#

function build_hamlib() {

local _GITV=$(dpkg --get-selections |grep git |awk 'FNR==1 {print $2}')
local _HAMLIBURL="git://git.code.sf.net/u/bsomervi/hamlib"
_jj=$(grep -c ^processor /proc/cpuinfo)

# checking for git
	clear
	echo "Checking Git .."
if [[ $_GITV == "install" ]]; then
	echo "Found Git .. OK"

else
	echo
	echo "GIT ERROR"
	echo
	echo "Git was not found, please check your installation"
	echo "and ensure Git can be used from ( $USER ) account"
	echo
	read -p "Press [Enter] continue .."
	echo
	clean_exit
fi

# Bills (G3WJS) Git Fork
	cd "$_SRCD"
	clear
	echo
	echo "BUILDING ( Hamlib )"

	# clone hamlib
	if [[ -d $_SRCD/g3wjs-hamlib ]]; then
		cd $_SRCD/g3wjs-hamlib
		echo "Updating Previous Hamlib Clone"	
		git pull
	else
		echo
		echo "Cloning G3WJS's Hamlib"
		git clone "$_HAMLIBURL" g3wjs-hamlib
	
		# checkout integration
		cd g3wjs-hamlib
		echo "Checkout out integration .. "
		git checkout integration
	fi

	# configure hamlib
	if [[ -d $_SRCD/build/hamlib ]]; then
		cd "$_SRCD"/build/hamlib
		make clean
	else
		mkdir -p "$_SRCD"/build/hamlib
		cd "$_SRCD"/build/hamlib
		"$_SRCD"/g3wjs-hamlib/autogen.sh --prefix="$BASED"/hamlib --disable-shared
		make -j$_JJ
		make install
		echo
		echo "Finished Building Hamlib .."
		echo
		read -p "Press [Enter] continue .."
		echo
	fi
}
